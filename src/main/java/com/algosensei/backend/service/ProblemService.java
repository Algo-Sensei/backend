package com.algosensei.backend.service;import java.util.List;import java.util.stream.Collectors;import org.springframework.stereotype.Service;import com.algosensei.backend.domain.dto.request.ProblemRequestDTO;import com.algosensei.backend.domain.dto.response.ProblemResponseDTO;import com.algosensei.backend.domain.entity.Problem;import com.algosensei.backend.domain.entity.User;import com.algosensei.backend.repository.ProblemRepository;import com.algosensei.backend.repository.UserRepository;import lombok.RequiredArgsConstructor;@Service@RequiredArgsConstructorpublic class ProblemService {    private final ProblemRepository problemRepository;    private final UserRepository userRepository;    /*     * Saves a new problem submitted by the user     * Validates that the associated user exists before saving     */    public ProblemResponseDTO create(ProblemRequestDTO request) {        /* find the user who submitted this problem throw error if not found */        User user = userRepository.findById(request.getUserId())                .orElseThrow(() -> new RuntimeException("User not found"));        Problem problem = Problem.builder()                .title(request.getTitle())                .description(request.getDescription())                .difficultyLevel(request.getDifficultyLevel())                .tags(request.getTags())                .user(user)                .build();        return toResponseDTO(problemRepository.save(problem));    }    /*     * Retrieves a single problem by its ID     * Useful when the user clicks on a problem from their history     */    public ProblemResponseDTO getById(Long id) {        Problem problem = problemRepository.findById(id)                .orElseThrow(() -> new RuntimeException("Problem not found"));        return toResponseDTO(problem);    }    /*     * retrieves all problems submitted by a specific user     * this is the user's problem history     */    public List<ProblemResponseDTO> getByUserId(Long userId) {        return problemRepository.findByUserId(userId)                .stream()                .map(this::toResponseDTO)                .collect(Collectors.toList());    }    /*     * deletes a problem from the user's history     * any suggestions linked to this problem are also deleted automatically     * via cascade = ALL defined in the Problem entity     */    public void delete(Long id) {        /* make sure the problem exists before trying to delete */        if (!problemRepository.existsById(id)) {            throw new RuntimeException("Problem not found");        }        problemRepository.deleteById(id);    }    // helper    //converts problem entity to problemResponseDTO    public ProblemResponseDTO toResponseDTO(Problem problem) {        return ProblemResponseDTO.builder()                .id(problem.getId())                .title(problem.getTitle())                .description(problem.getDescription())                .difficultyLevel(problem.getDifficultyLevel())                .tags(problem.getTags())                .userId(problem.getUser().getId()) // only return userId, not full User object                .build();    }}